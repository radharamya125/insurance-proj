pipeline {
    agent any
 
    stages {
        stage('Cloning') {
            steps {
                echo 'Cloining the code from the github repository.'
                git 'https://github.com/radharamya125/insurance-proj.git'

            }
        }

    stage('Building') {
            steps {
                echo 'package the given code by using maven'
                sh 'mvn clean package'
            }
            
        }


    stage('Publish TestNg report') {
           steps {
                echo 'Genrate HTML report using TestNg'
                publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: false, reportDir: '/var/lib/jenkins/workspace/Insurance-Project/target/surefire-reports', reportFiles: 'index.html', reportName: 'HTML Report', reportTitles: '', useWrapperFileDirectly: true])
           }

       }

   

    stage('Login') {
           steps {
                echo 'Login into the Dockerhub'
                withCredentials([usernamePassword(credentialsId: 'Dockerlogin', passwordVariable: 'dockerhub-password', usernameVariable: 'dockerhub-user')]) {
                sh 'sudo docker login -u ${env.dockerhub-user} -p ${env.dockerhub-password}'
                    }
           }

       }

     stage('Image Creating') {
           steps {
                echo 'creating an image using docker'
                sh 'sudo docker build -t radharamya/insurance-project:1.0 .'
           }

       }

     stage('Pushing') {
           steps {
                echo 'pushing the image into dockerhub'
                sh 'sudo docker push radharamya/insurance-project:1.0'
           }

       }


    

       
    

    






}
}
